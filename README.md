# Photo Watermark Tool

一个基于 Python 的图片水印工具，可以自动提取照片的 EXIF 拍摄日期，并将其作为水印添加到图片上。项目提供命令行 (CLI) 和图形用户界面 (GUI) 两种操作方式。

## 主要功能

- **双水印模式 (GUI)**：自由选择使用 **文本水印** 或 **图片水印**。
    - **文本水印**:
        - **内容灵活**: 可使用照片的 **EXIF 拍摄日期**，或输入**任意自定义文本**。
        - **样式丰富**: 自由调整字体大小、颜色和**透明度**。
        - **旋转支持**: 支持 -180° 到 +180° 的任意角度旋转。
    - **图片水印**:
        - **Logo 支持**: 可选择本地图片（如 Logo）作为水印，完美支持带透明通道的 PNG。
        - **智能缩放**: 水印图片可按主图宽度的一定**百分比**进行缩放。
        - **透明度控制**: 可独立调节图片水印的整体透明度。
        - **旋转支持**: 支持 -180° 到 +180° 的任意角度旋转。
- **多种导入方式 (GUI)**：
    - **文件选择器**：支持单张或多张图片选择。
    - **文件夹导入**：一键导入整个文件夹内的所有支持格式的图片。
    - **拖拽导入**：直接将文件或文件夹拖拽到程序窗口即可添加。
- **实时预览系统 (GUI)**：
    - **所见即所得**：所有水印设置更改在预览窗口中实时显示效果。
    - **图片切换预览**：点击图片列表中的任意图片即可切换预览。
    - **缩放功能**：使用鼠标滚轮可缩放预览图像以查看细节。
    - **预览信息显示**：实时显示图片尺寸、缩放比例、旋转角度和位置模式。
- **灵活的位置控制**:
    - **九宫格预设位置**：提供 9 个标准位置（四角、边缘中心、正中心）。
    - **手动拖拽定位**：直接在预览图上点击或拖拽水印到任意位置。
    - **精确位置调整**：支持像素级别的精确位置控制。
    - **位置模式切换**：可在预设位置和手动位置之间自由切换。
- **水印旋转功能**:
    - **任意角度旋转**：支持 -180° 到 +180° 的自由旋转。
    - **实时旋转预览**：旋转效果在预览中实时显示。
    - **智能旋转算法**：只旋转水印本身，不影响原始图像。
    - **角度重置**：一键重置旋转角度为 0°。
- **通用定位与导出**:
    - **自定义输出目录**：用户可指定任意文件夹作为输出位置，并有防止覆盖原图的警告机制。
    - **文件命名规则**：支持添加自定义前缀和后缀。
    - **JPEG 质量控制**：通过滑块调节 JPEG 图像的压缩质量。
    - **图像尺寸调整**：支持按宽度、高度或百分比缩放图片。
- **格式支持**：
    - **输入格式**：支持 JPEG, PNG, BMP, TIFF 等主流格式。
    - **输出格式**：可选择输出为 JPEG 或 PNG。
    - **PNG 透明通道**：完整保留和处理 PNG 图片的透明度。
- **批量处理**：无论是 CLI 还是 GUI 版本，都支持一次性处理大量图片。

## 安装

在开始之前，请确保您已安装 Python 3.7 或更高版本。

1.  克隆或下载此仓库到您的本地计算机。
2.  打开终端或命令提示符，进入项目根目录。
3.  运行以下命令安装所有必需的依赖库：

    ```bash
    pip install -r requirements.txt
    ```
    *注意：`tkinterdnd2` 库为 GUI 版本的拖拽功能提供支持。如果安装失败或环境不支持，GUI 仍然可以运行，但拖拽功能将不可用。*

## 使用方法

### 1. GUI 版本 (推荐)

GUI 版本提供了最直观、功能最丰富的操作体验。

**启动程序：**

```bash
python watermark_gui.py
```

**操作步骤：**

1.  **导入图片**：
    - 点击 **"选择文件"** 或 **"选择文件夹"** 按钮。
    - 或者直接将图片文件/文件夹 **拖拽** 到程序窗口中。
    - 导入的图片将以 **缩略图和文件名** 的形式显示在右侧列表中。

2.  **配置水印**：
    - 在左侧的"水印设置"面板中，首先选择 **"水印类型"**（文本或图片）。
    - **如果选择"文本"**:
        - **水印内容**: 选择"EXIF日期"或"自定义文本"，并按需输入文字。
        - **样式**: 调整字体大小、颜色和透明度。
    - **如果选择"图片"**:
        - **水印图片**: 点击"选择图片..."选择一个 Logo 文件。
        - **样式**: 调整水印的缩放比例和透明度。

3.  **设置水印位置**：
    - **使用预设位置**: 从"水印位置"下拉框中选择九宫格位置（如 top-left、center、bottom-right 等）。
    - **手动调整位置**: 
        - 在预览图上 **单击** 任意位置设置水印位置。
        - **拖拽** 水印到想要的精确位置。
        - **双击** 预览图可重置水印到当前选中的预设位置。

4.  **设置水印旋转**：
    - 使用"旋转角度"滑块调整水印角度（-180° 到 +180°）。
    - 点击"重置"按钮将角度重置为 0°。
    - 旋转效果在预览中实时显示。

5.  **实时预览**：
    - 点击图片列表中的任意图片查看预览效果。
    - 所有水印设置更改都会在预览窗口中实时显示。
    - 使用鼠标滚轮可缩放预览图像。
    - 预览信息会显示图片尺寸、缩放比例、旋转角度和位置模式（预设位置/手动位置）。

6.  **配置输出选项**:
    - 在"通用与输出设置"面板中完成以下配置：
    - **输出格式**: 选择 JPEG 或 PNG。若为 JPEG，可拖动滑块调整压缩率。
    - **输出文件夹**: 点击"选择..."按钮指定保存位置。
    - **文件命名**: 根据需要输入文件名前缀或后缀。
    - **调整尺寸**: 从下拉菜单选择缩放模式，并在右侧输入框填入具体数值。

7.  **开始处理**：
    - 点击 **"开始处理"** 按钮。
    - 程序将按照预览中显示的效果处理所有图片。
    - 下方的进度条将显示处理进度。
    - 处理完成后，会弹出提示框告知结果。

#### GUI 交互操作指南

**预览区域操作**：
- **鼠标滚轮**：缩放预览图像
- **单击**：设置水印位置
- **拖拽**：移动水印到精确位置
- **双击**：重置水印到预设位置

**图片列表操作**：
- **单击图片**：切换预览不同的图片
- **拖拽文件**：快速导入图片到列表

### 2. 命令行版本

对于喜欢使用终端或需要进行自动化脚本处理的用户，可以使用命令行版本。

**基本命令格式：**

```bash
python watermark.py [输入路径] [选项]
```

-   `[输入路径]`：可以是单张图片的路径，也可以是包含多个图片的文件夹路径。

**选项：**

-   `--font-size, -s`：设置字体大小 (默认: 36)。
-   `--color, -c`：设置字体颜色 (默认: "white")。支持颜色名称 (如 `red`) 或十六进制代码 (如 `#FF0000`)。
-   `--position, -p`：设置水印位置 (默认: `bottom-right`)。

**示例：**

```bash
# 处理单张图片，使用默认设置
python watermark.py ./pic/my_photo.jpg

# 处理整个文件夹，并将水印设置为红色的48号字体，位置在左上角
python watermark.py ./pic/ --font-size 48 --color red --position top-left

# 使用简写参数
python watermark.py ./pic/ -s 48 -c red -p top-left
```

### EXIF 日期提取说明
程序自动提取图片的 EXIF 拍摄时间信息，支持以下字段：
- DateTimeOriginal（原始拍摄时间）
- DateTimeDigitized（数字化时间）  
- DateTime（文件修改时间）

## 故障排除

-   **GUI 无法启动或缺少模块**：
    请确保已按照 **安装** 步骤成功安装所有 `requirements.txt` 中的依赖。

-   **拖拽功能无效**：
    这通常意味着 `tkinterdnd2` 库没有被正确安装或在您的操作系统/Python 环境中不受支持。您仍然可以通过 "选择文件" 和 "选择文件夹" 按钮正常使用程序。

-   **图片没有添加水印**：
    程序会自动跳过那些 **没有 EXIF 拍摄日期信息** 的图片。命令行窗口会打印相关提示。

-   **中文字体显示为方框** (非 Windows 系统)：
    程序默认会尝试加载常见的 Windows 字体 (如黑体、微软雅黑)。如果在 macOS 或 Linux 上出现问题，您可能需要修改 `watermark_gui.py` 或 `watermark.py` 文件中的字体路径，指向您系统中存在的中文字体文件。

-   **预览位置与输出结果不一致**：
    确保在预览调整完成后没有更改其他设置。手动调整的位置信息会自动保存并应用到最终输出中。
