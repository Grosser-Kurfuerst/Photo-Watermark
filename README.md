# Photo Watermark Tool

一个基于 Python 的图片水印工具，可以自动提取照片的 EXIF 拍摄日期，并将其作为水印添加到图片上。项目提供命令行 (CLI) 和图形用户界面 (GUI) 两种操作方式。

## 主要功能

- **双水印模式 (GUI)**：自由选择使用 **文本水印** 或 **图片水印**。
    - **文本水印**:
        - **内容灵活**: 可使用照片的 **EXIF 拍摄日期**，或输入**任意自定义文本**。
        - **样式丰富**: 自由调整字体大小、颜色和**透明度**。
    - **图片水印**:
        - **Logo 支持**: 可选择本地图片（如 Logo）作为水印，完美支持带透明通道的 PNG。
        - **智能缩放**: 水印图片可按主图宽度的一定**百分比**进行缩放。
        - **透明度控制**: 可独立调节图片水印的整体透明度。
- **多种导入方式 (GUI)**：
    - **文件选择器**：支持单张或多张图片选择。
    - **文件夹导入**：一键导入整个文件夹内的所有支持格式的图片。
    - **拖拽导入**：直接将文件或文件夹拖拽到程序窗口即可添加。
- **实时预览 (GUI)**：在列表中显示已导入图片的缩略图、文件名和提取的拍摄日期。
- **通用定位与导出**:
    - **统一位置**: 九点定位系统（如左上、右下）对文本和图片水印通用。
    - **自定义输出目录**：用户可指定任意文件夹作为输出位置，并有防止覆盖原图的警告机制。
    - **文件命名规则**：支持添加自定义前缀和后缀。
    - **JPEG 质量控制**：通过滑块调节 JPEG 图像的压缩质量。
    - **图像尺寸调整**：支持按宽度、高度或百分比缩放图片。
- **格式支持**：
    - **输入格式**：支持 JPEG, PNG, BMP, TIFF 等主流格式。
    - **输出格式**：可选择输出为 JPEG 或 PNG。
    - **PNG 透明通道**：完整保留和处理 PNG 图片的透明度。
- **批量处理**：无论是 CLI 还是 GUI 版本，都支持一次性处理大量图片。

## 安装

在开始之前，请确保您已安装 Python 3.7 或更高版本。

1.  克隆或下载此仓库到您的本地计算机。
2.  打开终端或命令提示符，进入项目根目录。
3.  运行以下命令安装所有必需的依赖库：

    ```bash
    pip install -r requirements.txt
    ```
    *注意：`tkinterdnd2` 库为 GUI 版本的拖拽功能提供支持。如果安装失败或环境不支持，GUI 仍然可以运行，但拖拽功能将不可用。*

## 使用方法

### 1. GUI 版本 (推荐)

GUI 版本提供了最直观、功能最丰富的操作体验。

**启动程序：**

```bash
python watermark_gui.py
```

**操作步骤：**

1.  **导入图片**：
    - 点击 **"选择文件"** 或 **"选择文件夹"** 按钮。
    - 或者直接将图片文件/文件夹 **拖拽** 到程序窗口中。
    - 导入的图片将以 **缩略图和文件名** 的形式显示在右侧列表中。
2.  **配置水印**：
    - 在左侧的“水印设置”面板中，首先选择 **“水印类型”**（文本或图片）。
    - **如果选择“文本”**:
        - **水印内容**: 选择“EXIF日期”或“自定义文本”，并按需输入文字。
        - **样式**: 调整字体大小、颜色和透明度。
    - **如果选择“图片”**:
        - **水印图片**: 点击“选择图片...”选择一个 Logo 文件。
        - **样式**: 调整水印的缩放比例和透明度。
3.  **配置通用与输出选项**:
    - 在下方的“通用与输出设置”面板中，完成以下配置：
    - **水印位置**: 从下拉菜单中选择一个位置。
    - **输出格式**: 选择 JPEG 或 PNG。若为 JPEG，可拖动滑块调整压缩率。
    - **输出文件夹**: 点击“选择...”按钮指定保存位置。
    - **文件命名**: 根据需要输入文件名前缀或后缀。
    - **调整尺寸**: 从下拉菜单选择缩放模式，并在右侧输入框填入具体数值。
4.  **开始处理**：
    - 点击 **"开始处理"** 按钮。
    - 下方的进度条将显示处理进度。
    - 处理完成后，会弹出提示框告知结果。

### 2. 命令行版本

对于喜欢使用终端或需要进行自动化脚本处理的用户，可以使用命令行版本。

**基本命令格式：**

```bash
python watermark.py [输入路径] [选项]
```

-   `[输入路径]`：可以是单张图片的路径，也可以是包含多个图片的文件夹路径。

**选项：**

-   `--font-size, -s`：设置字体大小 (默认: 36)。
-   `--color, -c`：设置字体颜色 (默认: "white")。支持颜色名称 (如 `red`) 或十六进制代码 (如 `#FF0000`)。
-   `--position, -p`：设置水印位置 (默认: `bottom-right`)。

**示例：**

```bash
# 处理单张图片，使用默认设置
python watermark.py ./pic/my_photo.jpg

# 处理整个文件夹，并将水印设置为红色的48号字体，位置在左上角
python watermark.py ./pic/ --font-size 48 --color red --position top-left

# 使用简写参数
python watermark.py ./pic/ -s 48 -c red -p top-left
```

## 故障排除

-   **GUI 无法启动或缺少模块**：
    请确保已按照 **安装** 步骤成功安装所有 `requirements.txt` 中的依赖。

-   **拖拽功能无效**：
    这通常意味着 `tkinterdnd2` 库没有被正确安装或在您的操作系统/Python 环境中不受支持。您仍然可以通过 "选择文件" 和 "选择文件夹" 按钮正常使用程序。

-   **图片没有添加水印**：
    程序会自动跳过那些 **没有 EXIF 拍摄日期信息** 的图片。命令行窗口会打印相关提示。

-   **中文字体显示为方框** (非 Windows 系统)：
    程序默认会尝试加载常见的 Windows 字体 (如黑体、微软雅黑)。如果在 macOS 或 Linux 上出现问题，您可能需要修改 `watermark_gui.py` 或 `watermark.py` 文件中的字体路径，指向您系统中存在的中文字体文件。
